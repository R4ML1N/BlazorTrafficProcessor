plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

group = 'com.gdssecurity'
version = '1.1'

java {
    toolchain { languageVersion = JavaLanguageVersion.of(17) }
}

repositories { mavenCentral() }

dependencies {
    // Burp Montoya API: compileOnly so it's not bundled (Burp provides it)
    compileOnly 'net.portswigger.burp.extensions:montoya-api:2025.8'

    // Updated runtime dependencies
    implementation 'org.msgpack:msgpack-core:0.9.10'
    implementation 'org.json:json:20250517'
    implementation 'org.apache.parquet:parquet-common:1.15.2'

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.10.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.10.0'
}

test { useJUnitPlatform() }

tasks.withType(JavaCompile).configureEach {
    options.compilerArgs << "-Xlint:unchecked"
}

tasks.shadowJar {
    archiveBaseName.set(project.name)
    archiveVersion.set(project.version.toString())
    archiveClassifier.set("") // no "-all" suffix
    destinationDirectory.set(layout.projectDirectory.dir("releases"))
    mergeServiceFiles()
}
